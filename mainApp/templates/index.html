<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Scheduler</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h1>Email Scheduler</h1>
    <form id="emailForm">
        <div class="mb-3">
            <label for="subject" class="form-label">Subject</label>
            <input type="text" class="form-control" id="subject" placeholder="Enter email subject" required>
        </div>
        <div class="mb-3">
            <label for="text" class="form-label">Message</label>
            <textarea class="form-control" id="text" rows="4" placeholder="Enter your message with time (e.g., 'The meeting is set for 11:24PM')" required></textarea>
        </div>
        <div class="mb-3">
            <label for="recipient_list" class="form-label">Recipients (Comma-separated emails)</label>
            <input type="email" class="form-control" id="recipient_list" placeholder="example1@gmail.com,example2@gmail.com" multiple required>
        </div>
        <div class="mb-3">
            <label for="html" class="form-label">HTML Content (Optional)</label>
            <textarea class="form-control" id="html" rows="2" placeholder="Optional HTML content"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Schedule Email</button>
    </form>
    <div id="responseMessage" class="mt-3"></div>
</div>

<script>
    // Handle form submission
    document.getElementById('emailForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const subject = document.getElementById('subject').value;
        const text = document.getElementById('text').value;
        const recipient_list = document.getElementById('recipient_list').value;
        const html = document.getElementById('html').value;

        try {
            const response = await fetch('http://127.0.0.1:8000/send-email', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    subject: subject,
                    text: text,
                    recipient_list: recipient_list,
                    html: html
                }),
            });

            const data = await response.json();
            const messageBox = document.getElementById('responseMessage');
            if (response.ok) {
                messageBox.innerHTML = `<div class="alert alert-success">Success: ${data.msg} <br> Scheduled for: ${data.scheduled_time}</div>`;
            } else {
                messageBox.innerHTML = `<div class="alert alert-danger">Error: ${data.msg}</div>`;
            }
        } catch (error) {
            document.getElementById('responseMessage').innerHTML = `<div class="alert alert-danger">An error occurred: ${error.message}</div>`;
        }
    });
</script>
</body>
</html>
